---
import * as userStore from "./store";
const stream = new TransformStream();
const writer = stream.writable.getWriter();
const encoder = new TextEncoder();

writer.write(encoder.encode(`data: ${userStore.selectedUserId}\n\n`));
userStore.onUserChange((user) => {
  writer.write(encoder.encode(`data: ${JSON.stringify(user)}\n\n`));
});

return new Response(stream.readable, {
  status: 200,
  headers: {
    "Content-Type": "text/event-stream",
    Connection: "keep-alive",
    "Cache-Control": "no-cache",
  },
});
---
